var Main={data:()=>({downloading:!1,pretty_json:!1,drawer:!1,options:"",encoding:"",docs:"",current_template:"",crawler_rule:{name:"",regex:"^https://httpbin.org/html$",parse_rules:[{name:"title",chain_rules:[["css","title,h1","$text"],["py","index","0"]],child_rules:"[]",iter_parse_child:!1}],request_args:JSON.stringify({method:"get",url:"https://httpbin.org/html",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},null,2)},input_object:"",request_status:"",parse_result:"",current_doc:"",doc_drawer:!1,new_rule_visible:!1,new_rule_json:"",parse_rule_idx_to_send:null,send_child_rule_visible:!1,template_visible:!1,request_template_values:{}}),methods:{querySearch(e,t){var r=this.options;t(e?r.filter(this.createFilter(e)):r)},createFilter:e=>t=>0===t.value.toLowerCase().indexOf(e.toLowerCase()),openAlert(e,t){this.$alert(e,t,{confirmButtonText:"Ok",distinguishCancelAndClose:!0,closeOnPressEscape:!0,closeOnClickModal:!0})},download(){var e=this.current_crawler_rule_json;this.downloading=!0,this.request_status="(Downloading)",this.input_object="",this.$http.post("request",e).then(e=>{let t=e.body.text;if(this.input_object=t.replace(/^\s+/,""),!this.crawler_rule.name){let e="U-"+(new Date).getTime().toString().slice(0,-3);try{var r=(new DOMParser).parseFromString(t,"text/html");let s=(r.getElementsByTagName("title")[0]||r.getElementsByTagName("h1")[0]||r.getElementsByTagName("h2")[0]||"").innerText,l=(s=s.replace(/-.*/g,""))||this.crawler_rule.request_args.url||e;this.crawler_rule.name=l}catch(t){this.crawler_rule.name=e}}this.request_status=e.body.status;let s=e.body.ok?"green":"red";document.querySelector("#request_status>label").style.color=s,this.downloading=!1},e=>{this.status="testTask failed, Bad request ("+e.status+") :"+e.statusText,this.status_icon_flag="error",this.downloading=!1,this.openAlert(this.status)})},parse(){var e={rule:this.current_crawler_rule_json,input_object:this.input_object};this.crawler_rule.parse_rules&&this.input_object?this.$http.post("parse",JSON.stringify(e)).then(e=>{this.parse_result=e.body,this.drawer=!0},e=>{this.openAlert(e.body,"Request Error")}):this.openAlert("Send request and fill the parse_rules before parsing")},add_new_rule_chain(e){this.crawler_rule.parse_rules[e].chain_rules.push(["","",""])},add_new_rule(){this.crawler_rule.parse_rules.push({name:"",chain_rules:[["","",""]],child_rules:"",iter_parse_child:!1})},tail_rule(){if(this.send_child_rule_visible=!1,null!=this.parse_rule_idx_to_send){let e=this.crawler_rule.parse_rules.splice(this.parse_rule_idx_to_send,1)[0];this.crawler_rule.parse_rules.push(e)}this.parse_rule_idx_to_send=null},send_child(e,t){this.send_child_rule_visible=!1;let r=JSON.parse(e.child_rules||"[]"),s=this.crawler_rule.parse_rules[this.parse_rule_idx_to_send];s.child_rules=JSON.parse(s.child_rules||"[]"),r.push(s),this.crawler_rule.parse_rules[t].child_rules=JSON.stringify(r),this.crawler_rule.parse_rules.splice(this.parse_rule_idx_to_send,1)[0],this.parse_rule_idx_to_send=null,setTimeout(()=>{for(const e of document.getElementsByTagName(".child-rules-input>textarea"))e.style.height="auto",e.style.height=e.scrollHeight+"px";this.iframe_loaded=!0},0)},open_send_child_dialog(e){this.parse_rule_idx_to_send=e,this.send_child_rule_visible=!0},del_rule(e){this.crawler_rule.parse_rules.splice(e,1)},del_rule_chain(e,t){this.crawler_rule.parse_rules[e].chain_rules.splice(t,1)},get_doc(e){this.current_doc=this.docs[e]||"Not found parser: "+e,this.doc_drawer=!0},load_rule(){if(this.new_rule_json)try{var e=JSON.parse(this.new_rule_json);e.request_args&&e.request_args.url&&(e.request_args=JSON.stringify(e.request_args,null,2)),e.request_template&&(e.request_template=JSON.stringify(e.request_template,null,2)),e.parse_rules.forEach(e=>{e.child_rules&&(e.child_rules=JSON.stringify(e.child_rules))}),this.crawler_rule=e,this.new_rule_visible=!1}catch(e){alert(e)}else this.new_rule_visible=!1},load_rule_popup(){this.new_rule_visible=!0,setTimeout(()=>{this.$refs.load_json_input.focus()},0),this.new_rule_json||(this.new_rule_json=this.current_crawler_rule_json)},show_request_template(){this.template_visible=!0,this.current_template=this.crawler_rule.request_template||this.crawler_rule.request_args,this.request_template_values={}},update_template(){try{JSON.parse(this.current_template),this.$set(this.crawler_rule,"request_template",this.current_template)}catch(e){this.openAlert(e,"Error")}},add_to_request_args(){try{new Set(this.current_template.match(/\$\{.*?\}/g)).forEach(e=>{if(!this.request_template_values[e])throw e+" should not be null"});let e=this.current_template;Object.keys(this.request_template_values).forEach(t=>{let r=0;for(;r<1e3;){r+=1;let s=e.replace(t,this.request_template_values[t]);if(s==e)break;e=s}}),this.$set(this.crawler_rule,"request_args",JSON.stringify(JSON.parse(e),null,2)),this.template_visible=!1}catch(e){this.openAlert(e,"Error"),this.template_visible=!0}},demo_handle_click(e){let t={CSS:'{"name":"","request_args":{"method":"get","url":"http://httpbin.org/html","headers":{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},"parse_rules":[{"name":"text","chain_rules":[["css","body h1","$text"],["python","getitem","[0]"]],"child_rules":""}],"regex":"^http://httpbin.org/html$","encoding":""}',"XML(RSS)":'{"name":"","request_args":{"method":"get","url":"https://importpython.com/blog/feed/","headers":{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},"parse_rules":[{"name":"text","chain_rules":[["xml","channel>item>title","$text"],["python","getitem","[0]"]],"child_rules":""},{"name":"url","chain_rules":[["xml","channel>item>link","$text"],["python","getitem","[0]"]],"child_rules":""}],"regex":"^https?://importpython.com/blog/feed/$","encoding":""}',Regex:'{"name":"","request_args":{"method":"get","url":"http://myip.ipip.net/","headers":{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},"parse_rules":[{"name":"find one","chain_rules":[["re","(\\\\d+\\\\.){3}\\\\d+","$0"]],"child_rules":[]},{"name":"findall","chain_rules":[["re","\\\\d+",""]],"child_rules":[],"iter_parse_child":false},{"name":"find group","chain_rules":[["re","(\\\\d+\\\\.){3}\\\\d+","$1"]],"child_rules":[],"iter_parse_child":false},{"name":"Zero-Length Assertions: find the aa not a or aaa","chain_rules":[["py","const","aaababaaccc"],["re","(?<=[^a])aa(?=[^a])",""]],"child_rules":[],"iter_parse_child":false},{"name":"re.sub","chain_rules":[["re","(\\\\d+)","@\\\\1+"]],"child_rules":[],"iter_parse_child":false},{"name":"re.split","chain_rules":[["re","\\\\s","-"]],"child_rules":[],"iter_parse_child":false}],"regex":"^http://myip\\\\.ipip\\\\.net/$"}',JSON:'{"name":"U-1588672624","request_args":{"method":"get","url":"http://httpbin.org/json","headers":{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},"parse_rules":[{"name":"jmes_demo","chain_rules":[["jmespath","JSON.slideshow.slides[1].title",""]],"child_rules":[],"iter_parse_child":false},{"name":"jsonpath_demo","chain_rules":[["jsonpath","JSON.slideshow.slides[1].title",""]],"child_rules":[],"iter_parse_child":false},{"name":"jsonpath_demo2","chain_rules":[["jsonpath","$.slideshow.slides[1].title",""]],"child_rules":[],"iter_parse_child":false},{"name":"objectpath_demo","chain_rules":[["objectpath","$.slideshow.slides[1].title",""]],"child_rules":[],"iter_parse_child":false},{"name":"objectpath_demo2","chain_rules":[["objectpath","JSON.slideshow.slides[1].title",""]],"child_rules":[],"iter_parse_child":false}],"regex":"^http://httpbin\\\\.org/json$"}',UDF:'{"name":"","request_args":{"method":"get","url":"http://httpbin.org/json","headers":{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},"parse_rules":[{"name":"context_resp_demo","chain_rules":[["udf","context[\'resp\'].url",""]],"child_rules":[],"iter_parse_child":false},{"name":"context_parse_result_demo","chain_rules":[["udf","context[\'parse_result\'][\'context_resp_demo\']",""]],"child_rules":[],"iter_parse_child":false},{"name":"lambda_demo","chain_rules":[["udf","parse = lambda input_object: 123",""]],"child_rules":[],"iter_parse_child":false},{"name":"context_and_function_demo","chain_rules":[["udf","def parse(input_object):\\n    context[\'a\'] = 1\\n    return 2",""],["udf","context[\'a\'] + input_object",""]],"child_rules":[],"iter_parse_child":false},{"name":"obj_alias_demo","chain_rules":[["udf","1",""],["udf","int(obj)",""]],"child_rules":[],"iter_parse_child":false}],"regex":"^http://httpbin\\\\.org/json$"}',Null:'{"name":"","request_args":"{}","parse_rules":[],"regex":"","encoding":""}'};this.new_rule_json=t[e],this.input_object="",this.request_status="",this.load_rule()},input_curl(){this.$prompt("Input cURL string (or URL)","",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputPattern:/^(curl |http).*/,inputErrorMessage:"cURL string should start with curl, or url should start with http"}).then(({value:e})=>{this.$http.post("curl_parse",e).then(e=>{let t=e.body;if(t.ok){this.crawler_rule.request_args=JSON.stringify(t.result,null,2);let e=t.result.url;e&&(this.crawler_rule.regex="^"+e.replace(/([\.\?\+\*\^\$])/g,"\\$1")+"$")}else this.$message({type:"error",message:"cURL parse failed: "+t.result})},()=>{this.$message({type:"error",message:"cURL parse failed"})})}).catch(()=>{})}},watch:{encoding(){let e=JSON.parse(this.crawler_rule.request_args);e.encoding=this.encoding,this.crawler_rule.request_args=JSON.stringify(e,null,2)}},computed:{current_request_url:function(){try{return JSON.parse(this.crawler_rule.request_args).url||""}catch(e){return""}},current_crawler_rule_json:function(){try{var e=[];this.crawler_rule.parse_rules.forEach(t=>{if(t.name){try{var r=JSON.parse(t.child_rules||"[]")}catch(e){r=t.child_rules}var s=[];t.chain_rules.forEach(e=>{e[0]&&e[1]&&s.push([e[0],e[1],e[2]])}),e.push({name:t.name,chain_rules:s,child_rules:r,iter_parse_child:t.iter_parse_child})}});var t={name:this.crawler_rule.name,request_args:JSON.parse(this.crawler_rule.request_args),parse_rules:e,regex:this.crawler_rule.regex};return this.crawler_rule.request_template&&(t.request_template=JSON.parse(this.crawler_rule.request_template)),this.crawler_rule.request_args=JSON.stringify(t.request_args,null,2),this.pretty_json?JSON.stringify(t,null,2):JSON.stringify(t)}catch(e){return e}}}};function init_app(e){let t=document.getElementById("init_vars"),r=JSON.parse(window.atob(t.innerHTML));console.log(r),Object.keys(r).forEach(t=>{e[t]=r[t]}),t.parentNode.removeChild(t),new ClipboardJS(".cp-button").on("success",function(){e.$message({message:"Copy success",type:"success"})})}var vue_app=Vue.extend(Main),app=new vue_app({delimiters:["${","}"]}).$mount("#app");init_app(app);
